<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Log Blood Sugar • MEDUCO</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <a href="patient-dashboard.html" class="brand">MEDUCO</a>
        <nav class="nav" id="nav">
          <a href="patient-dashboard.html">← Back to Dashboard</a>
          <a href="login.html">Logout</a>
        </nav>
        <button aria-label="Toggle menu" class="nav-toggle" id="navToggle">
          <span></span><span></span><span></span>
        </button>
      </div>
    </header>

    <main>
      <section class="section">
        <div class="container" style="max-width: 800px">
          <h1>Blood Sugar Readings</h1>
          <p class="muted">View your recent glucose levels and target ranges.</p>
          
          <!-- Recent History -->
          <div class="card">
            <h3 style="margin-top:0">Recent Readings</h3>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Reading</th>
                    <th>Type</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Today 8:00 AM</td>
                    <td style="color: #059669; font-weight: 600;">126 mg/dL</td>
                    <td>Fasting</td>
                  </tr>
                  <tr>
                    <td>Yesterday 8:00 PM</td>
                    <td style="color: #dc2626; font-weight: 600;">145 mg/dL</td>
                    <td>Bedtime</td>
                  </tr>
                  <tr>
                    <td>Yesterday 2:00 PM</td>
                    <td style="color: #059669; font-weight: 600;">118 mg/dL</td>
                    <td>After Meal</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Target Ranges -->
          <div class="card" style="margin-top: 24px;">
            <h3 style="margin-top:0">Target Blood Sugar Ranges</h3>
            <div class="grid-2">
              <div>
                <h4>Before Meals</h4>
                <p style="color: #059669; font-weight: 600;">80-130 mg/dL</p>
              </div>
              <div>
                <h4>After Meals (2 hours)</h4>
                <p style="color: #059669; font-weight: 600;">Less than 180 mg/dL</p>
              </div>
              <div>
                <h4>Fasting</h4>
                <p style="color: #059669; font-weight: 600;">80-130 mg/dL</p>
              </div>
              <div>
                <h4>Bedtime</h4>
                <p style="color: #059669; font-weight: 600;">90-150 mg/dL</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        © <span id="year"></span> MEDUCO
      </div>
    </footer>

    <script src="api.js"></script>
    <script src="script.js"></script>
    <script>
      // Load blood sugar readings on page load
      document.addEventListener('DOMContentLoaded', async function() {
        await loadBloodSugarReadings();
      });

      async function loadBloodSugarReadings() {
        try {
          const response = await window.meducoAPI.getPatientHealthRecords({ type: 'blood_sugar', limit: 10 });
          const records = response.data.records || [];

          const tbody = document.querySelector('tbody');
          if (records.length > 0) {
            tbody.innerHTML = records.map(record => {
              const date = new Date(record.recorded_at).toLocaleDateString();
              const time = new Date(record.recorded_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
              const reading = record.value;
              const type = record.metadata?.type || 'General';

              // Color coding based on ranges
              let color = '#059669'; // green
              if (reading > 180) color = '#dc2626'; // red
              else if (reading > 130) color = '#d97706'; // amber

              return `
                <tr>
                  <td>${date} ${time}</td>
                  <td style="color: ${color}; font-weight: 600;">${reading} mg/dL</td>
                  <td>${type}</td>
                </tr>
              `;
            }).join('');
          } else {
            tbody.innerHTML = `
              <tr>
                <td colspan="3" style="text-align: center; color: var(--text-secondary);">No blood sugar readings found</td>
              </tr>
            `;
          }
        } catch (error) {
          console.error('Failed to load blood sugar readings:', error);
          const tbody = document.querySelector('tbody');
          tbody.innerHTML = `
            <tr>
              <td colspan="3" style="text-align: center; color: var(--text-secondary);">Failed to load readings. Please try again later.</td>
            </tr>
          `;
        }
      }
    </script>
  </body>
</html>
